<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Memed integrada ao Ninsa√∫de</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    #memed-container {
      width: 100%;
      height: 100%;
      min-height: 600px;
    }

    #btnSimularPaciente {
      position: fixed;
      top: 16px;
      right: 16px;
      z-index: 9999;
      padding: 10px 14px;
      font-size: 14px;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <button id="btnSimularPaciente">
    Simular paciente do Ninsa√∫de
  </button>

  <!-- üîπ CONTAINER DA MEMED -->
  <div id="memed-container"></div>

  <!-- Script da Memed -->
  <script
    src="https://integrations.memed.com.br/modulos/plataforma.sinapse-prescricao/build/sinapse-prescricao.min.js"
    data-token="SEU_TOKEN_AQUI">
  </script>

  <script>
    let pacienteRecebido = null;
    let memedPronta = false;

    // 1Ô∏è‚É£ Espera o MdHub existir
    const waitForMdHub = setInterval(() => {
      if (!window.MdHub || !window.MdHub.module) return;

      clearInterval(waitForMdHub);
      memedPronta = true;

      // üîπ Mostra o m√≥dulo MESMO SEM PACIENTE
      MdHub.module.show("plataforma.prescricao");
    }, 200);

    // 2Ô∏è‚É£ Bot√£o de simula√ß√£o (substitui console)
    document
      .getElementById("btnSimularPaciente")
      .addEventListener("click", function () {
        if (!memedPronta) return;

        const paciente = {
          id: "ns-simulado-1",
          nome: "Maria da Silva",
          sexo: "F",
          dataNascimento: "1985-07-22",
          cpf: "12345678900",
          endereco: {
            logradouro: "Rua das Flores",
            numero: "123",
            bairro: "Centro",
            cidade: "S√£o Paulo",
            uf: "SP",
            cep: "01001000"
          }
        };

        // Identidade
        MdHub.command.send("plataforma.prescricao", "setPaciente", {
          nome: paciente.nome,
          sexo: paciente.sexo,
          dataNascimento: paciente.dataNascimento,
          documento: paciente.cpf,
          external_id: paciente.id
        });

        // Endere√ßo (controlados)
        MdHub.command.send("plataforma.prescricao", "setEnderecoPaciente", {
          logradouro: paciente.endereco.logradouro,
          numero: paciente.endereco.numero,
          bairro: paciente.endereco.bairro,
          cidade: paciente.endereco.cidade,
          uf: paciente.endereco.uf,
          cep: paciente.endereco.cep
        });

        // Abre prescri√ß√£o
        MdHub.command.send("plataforma.prescricao", "openPrescription");
      });
  </script>

</body>
</html>
