<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Memed + Ninsaúde</title>

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont;
    }

    #btnSimularPaciente {
      position: fixed;
      top: 16px;
      right: 16px;
      z-index: 9999;
      padding: 10px 14px;
      font-size: 14px;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <button id="btnSimularPaciente">
    Simular paciente do Ninsaúde
  </button>

  <!-- Script da Memed -->
  <script
    src="https://integrations.memed.com.br/modulos/plataforma.sinapse-prescricao/build/sinapse-prescricao.min.js"
    data-token="eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.WzkwMzg3LCIwYTZiZTgwM2U1YTcwNTg5NDJmZGQ2NmU3MzU2YWM1MSIsIjIwMjYtMDEtMjIiLCJzaW5hcHNlLnByZXNjcmljYW8iLCJwYXJ0bmVyLjMuODU1MjAiXQ.DbTqxosooGFCD6OhWW_ClktXPZN4B1Ecnev4OsavoXs">
  </script>

  <script>
    let memedReady = false;

    // Aguarda a Memed ficar pronta
    window.addEventListener("message", function (event) {
      if (event?.data?.type === "MDHUB_ALL_MODULES_READY") {
        memedReady = true;
        console.log("Memed pronta para receber comandos");
      }
    });

    // Clique no botão
    document
      .getElementById("btnSimularPaciente")
      .addEventListener("click", function () {

        console.log("CLIQUEI NO BOTÃO");

        if (!memedReady) {
          console.error("Memed ainda não está pronta");
          return;
        }

        if (typeof MdHub === "undefined") {
          console.error("MdHub não existe");
          return;
        }

        console.log("MdHub existe, enviando paciente");

        // Paciente
        MdHub.command.send("plataforma.prescricao", "setPaciente", {
          nome: "Maria da Silva",
          sexo: "F",
          dataNascimento: "1985-07-22",
          documento: "12345678900",
          external_id: "ns-simulado-1"
        });

        // Endereço (necessário para controlados)
        MdHub.command.send("plataforma.prescricao", "setEnderecoPaciente", {
          logradouro: "Rua das Flores",
          numero: "123",
          bairro: "Centro",
          cidade: "São Paulo",
          uf: "SP",
          cep: "01001000"
        });

        // Abrir prescrição
        MdHub.command.send(
          "plataforma.prescricao",
          "openPrescription"
        );
      });
  </script>

</body>
</html>
