<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Memed integrada ao Ninsa√∫de</title>

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont;
    }

    #btnSimularPaciente {
      position: fixed;
      top: 16px;
      right: 16px;
      z-index: 9999;
      padding: 10px 14px;
      font-size: 14px;
      cursor: pointer;
    }

    #btnSimularPaciente[disabled] {
      opacity: 0.6;
      cursor: not-allowed;
    }
  </style>
</head>

<body>

  <button id="btnSimularPaciente" disabled>
    Carregando Memed‚Ä¶
  </button>

  <!-- SCRIPT OFICIAL DA MEMED -->
  <script
    src="https://integrations.memed.com.br/modulos/plataforma.sinapse-prescricao/build/sinapse-prescricao.min.js"
    data-token="eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.WzkwMzg3LCIwYTZiZTgwM2U1YTcwNTg5NDJmZGQ2NmU3MzU2YWM1MSIsIjIwMjYtMDEtMjIiLCJzaW5hcHNlLnByZXNjcmljYW8iLCJwYXJ0bmVyLjMuODU1MjAiXQ.DbTqxosooGFCD6OhWW_ClktXPZN4B1Ecnev4OsavoXs">
  </script>

  <script>
    const btn = document.getElementById("btnSimularPaciente");

    /**
     * Espera REAL pela Memed.
     * N√£o usa evento, n√£o usa postMessage.
     * S√≥ libera quando o MdHub existe.
     */
    function esperarMemed() {
      if (window.MdHub && window.MdHub.command) {
        console.log("‚úÖ MdHub dispon√≠vel ‚Äî Memed pronta");
        btn.disabled = false;
        btn.innerText = "Simular paciente do Ninsa√∫de";
        return;
      }

      setTimeout(esperarMemed, 300);
    }

    esperarMemed();

    /**
     * Clique do bot√£o
     */
    btn.addEventListener("click", function () {
      console.log("üü¢ Clique no bot√£o");

      if (!window.MdHub || !window.MdHub.command) {
        console.error("‚ùå MdHub ainda n√£o dispon√≠vel");
        return;
      }

      console.log("‚û°Ô∏è Enviando paciente para a Memed");

      // 1Ô∏è‚É£ Paciente
      MdHub.command.send("plataforma.prescricao", "setPaciente", {
        nome: "Maria da Silva",
        sexo: "F",
        dataNascimento: "1985-07-22",
        documento: "12345678900",
        external_id: "ns-simulado-1"
      });

      // 2Ô∏è‚É£ Endere√ßo (obrigat√≥rio para receitas controladas)
      MdHub.command.send("plataforma.prescricao", "setEnderecoPaciente", {
        logradouro: "Rua das Flores",
        numero: "123",
        bairro: "Centro",
        cidade: "S√£o Paulo",
        uf: "SP",
        cep: "01001000"
      });

      // 3Ô∏è‚É£ Abrir prescri√ß√£o
      MdHub.command.send(
        "plataforma.prescricao",
        "createPrescription"
      );
    });
  </script>

</body>
</html>
