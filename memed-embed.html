<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Memed Embed â€“ Teste</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- HUB -->
  <script src="https://integrations.memed.com.br/modulos/plataforma.hub/branch/master/plataforma.hub.min.js"></script>

  <!-- PRESCRIÃ‡ÃƒO -->
  <script src="https://integrations.memed.com.br/modulos/sinapse-prescricao/branch/master/sinapse-prescricao.min.js"></script>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont;
      padding: 40px;
    }
    button {
      font-size: 16px;
      padding: 14px 22px;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <h1>Memed â€“ Teste Oficial</h1>
  <button id="abrir">Abrir prescriÃ§Ã£o</button>

  <script>
    console.log("ğŸ“„ PÃ¡gina carregada");

    function esperarMdHub(callback) {
      const interval = setInterval(() => {
        if (window.MdHub && MdHub.command && MdHub.on) {
          clearInterval(interval);
          console.log("âœ… MdHub disponÃ­vel");
          callback();
        }
      }, 300);
    }

    esperarMdHub(() => {

      // ğŸ” 1ï¸âƒ£ TOKEN â€” OBRIGATÃ“RIO
      MdHub.command.send(
        "plataforma.sdk",
        "setToken",
        "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.WzkwMzg3LCIwYTZiZTgwM2U1YTcwNTg5NDJmZGQ2NmU3MzU2YWM1MSIsIjIwMjYtMDEtMjIiLCJzaW5hcHNlLnByZXNjcmljYW8iLCJwYXJ0bmVyLjMuODU1MjAiXQ.DbTqxosooGFCD6OhWW_ClktXPZN4B1Ecnev4OsavoXs"
      );

      console.log("ğŸ”‘ Token enviado");

      document.getElementById("abrir").addEventListener("click", () => {
        console.log("ğŸŸ¢ Clique no botÃ£o");

        // ğŸ‘¤ 2ï¸âƒ£ PACIENTE
        MdHub.command.send("plataforma.prescricao", "setPaciente", {
          nome: "Maria da Silva",
          sexo: "F",
          dataNascimento: "1985-07-22",
          documento: "12345678900",
          tipoDocumento: "CPF",
          external_id: "ns-1"
        });

        console.log("ğŸ‘¤ Paciente enviado");

        // ğŸ  3ï¸âƒ£ ENDEREÃ‡O (obrigatÃ³rio p/ controlados)
        MdHub.command.send("plataforma.prescricao", "setEnderecoPaciente", {
          logradouro: "Rua das Flores",
          numero: "123",
          bairro: "Centro",
          cidade: "SÃ£o Paulo",
          uf: "SP",
          cep: "01001000",
          pais: "BR"
        });

        console.log("ğŸ  EndereÃ§o enviado");

        // ğŸš€ 4ï¸âƒ£ ABRIR PRESCRIÃ‡ÃƒO
        MdHub.on("plataforma.prescricao.ready", function () {
          console.log("ğŸš€ Abrindo prescriÃ§Ã£o");

          MdHub.command.send(
            "plataforma.prescricao",
            "createPrescription"
          );
        });
      });
    });
  </script>

</body>
</html>
