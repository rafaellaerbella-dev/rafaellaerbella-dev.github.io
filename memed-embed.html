<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Memed integrada ao Ninsa√∫de</title>

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont;
    }

    #btnSimularPaciente {
      position: fixed;
      top: 16px;
      right: 16px;
      z-index: 9999;
      padding: 10px 14px;
      font-size: 14px;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <button id="btnSimularPaciente">
    Simular paciente do Ninsa√∫de
  </button>

  <!-- Script da Memed -->
  <script
    src="https://integrations.memed.com.br/modulos/plataforma.sinapse-prescricao/build/sinapse-prescricao.min.js"
    data-token="SEU_TOKEN_AQUI">
  </script>

  <script>
    let memedReady = false;

    // ‚úÖ EVENTO CORRETO
    window.addEventListener("message", function (event) {
      if (
        event.data &&
        event.data.type === "MDHUB_ALL_MODULES_READY"
      ) {
        memedReady = true;
        console.log("Memed pronta para receber comandos");
      }
    });

    // üîπ Bot√£o de simula√ß√£o
    document
      .getElementById("btnSimularPaciente")
      .addEventListener("click", function () {
        if (!memedReady) {
          alert("Memed ainda n√£o est√° pronta");
          return;
        }

        const paciente = {
          id: "ns-simulado-1",
          nome: "Maria da Silva",
          sexo: "F",
          dataNascimento: "1985-07-22",
          cpf: "12345678900",
          endereco: {
            logradouro: "Rua das Flores",
            numero: "123",
            bairro: "Centro",
            cidade: "S√£o Paulo",
            uf: "SP",
            cep: "01001000"
          }
        };

        // Identidade
        MdHub.command.send("plataforma.prescricao", "setPaciente", {
          nome: paciente.nome,
          sexo: paciente.sexo,
          dataNascimento: paciente.dataNascimento,
          documento: paciente.cpf,
          external_id: paciente.id
        });

        // Endere√ßo
        MdHub.command.send("plataforma.prescricao", "setEnderecoPaciente", {
          logradouro: paciente.endereco.logradouro,
          numero: paciente.endereco.numero,
          bairro: paciente.endereco.bairro,
          cidade: paciente.endereco.cidade,
          uf: paciente.endereco.uf,
          cep: paciente.endereco.cep
        });

        // üöÄ Agora sim
        MdHub.command.send("plataforma.prescricao", "openPrescription");
      });
  </script>

</body>
</html>
