<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Prescri√ß√£o</title>

    <style>
      html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: #fff;
      }
    </style>
  </head>

  <body>

    <script>
      /************************************************************
       * 1. CONFIGURA√á√ïES B√ÅSICAS
       ************************************************************/
      const MEMED_TOKEN = "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.WzkwMzg3LCIwYTZiZTgwM2U1YTcwNTg5NDJmZGQ2NmU3MzU2YWM1MSIsIjIwMjYtMDEtMjIiLCJzaW5hcHNlLnByZXNjcmljYW8iLCJwYXJ0bmVyLjMuODU1MjAiXQ.DbTqxosooGFCD6OhWW_ClktXPZN4B1Ecnev4OsavoXs";

      // Dados de exemplo ‚Äî na pr√°tica v√™m do Ninsa√∫de
      const paciente = {
        idExterno: "paciente-123",          // obrigat√≥rio
        nome: "Paciente Teste",              // obrigat√≥rio
        telefone: "11999999999",              // obrigat√≥rio
        cpf: "12345678900",                   // obrigat√≥rio (ou withoutCpf: true)
        dataNascimento: "1990-01-01",         // obrigat√≥rio
        email: "paciente@email.com",          // recomendado
        endereco: "Rua Exemplo, 123"           // obrigat√≥rio p/ receita controlada
      };

      /************************************************************
       * 2. CARREGAR SCRIPT DA MEMED
       ************************************************************/
      function carregarMemed() {
        const script = document.createElement("script");
        script.src =
          "https://integrations.memed.com.br/modulos/plataforma.sinapse-prescricao/build/sinapse-prescricao.min.js";

        script.dataset.token = MEMED_TOKEN;

        script.onload = () => {
          console.log("‚úÖ Script da Memed carregado");
          iniciarIntegracao();
        };

        document.body.appendChild(script);
      }

      /************************************************************
       * 3. INICIALIZA√á√ÉO DA INTEGRA√á√ÉO
       ************************************************************/
      function iniciarIntegracao() {
        // Aguarda o m√≥dulo de prescri√ß√£o ficar pronto
        MdSinapsePrescricao.event.add(
          "core:moduleInit",
          async function (module) {
            if (module.name !== "plataforma.prescricao") return;

            console.log("‚úÖ M√≥dulo de prescri√ß√£o pronto");

            // Envia paciente
            await MdHub.command.send(
              "plataforma.prescricao",
              "setPaciente",
              paciente
            );

            // Abre a prescri√ß√£o
            MdHub.module.show("plataforma.prescricao");
          }
        );

        registrarEventosObrigatorios();
      }

      /************************************************************
       * 4. EVENTOS OBRIGAT√ìRIOS (MESMO SEM USAR)
       ************************************************************/
      function registrarEventosObrigatorios() {
        // Quando a prescri√ß√£o for impressa
        MdHub.event.add("prescricaoImpressa", function (payload) {
          console.log("üìÑ Prescri√ß√£o impressa", payload);
          // N√£o salvamos ‚Äî apenas escutamos (boa pr√°tica Memed)
        });

        // Quando a prescri√ß√£o for exclu√≠da
        MdHub.event.add("prescricaoExcluida", function (payload) {
          console.log("üóëÔ∏è Prescri√ß√£o exclu√≠da", payload);
        });
      }

      /************************************************************
       * 5. START
       ************************************************************/
      carregarMemed();
    </script>

  </body>
</html>
